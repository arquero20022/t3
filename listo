#!/bin/bash

# Verificar que se proporcionen dos argumentos
if [ "$#" -ne 2 ]; then
    echo "Uso: $0 <directorio_origen> <directorio_destino>"
    exit 1
fi

SRC_DIR=$1
DEST_DIR=$2

# Crear un directorio temporal para la copia modificada
TEMP_DIR=$(mktemp -d)

# Copiar todo el contenido al directorio temporal
cp -a "$SRC_DIR/." "$TEMP_DIR/"

# Convertir symlinks a archivos regulares en el directorio temporal
find "$TEMP_DIR" -type l -print0 | while IFS= read -r -d $'\0' link; do
    target=$(readlink -f "$link")  # Obtener el destino absoluto del enlace
    if [ -f "$target" ]; then
        cp --remove-destination "$target" "$link"
        echo "Reemplazado: $link -> $target"
    else
        echo "El archivo objetivo no existe: $target"
    fi
done

# Crear el directorio de destino si no existe
mkdir -p "$DEST_DIR"

# Copiar el directorio temporal al destino
cp -a "$TEMP_DIR/." "$DEST_DIR/"

# Limpiar el directorio temporal
rm -rf "$TEMP_DIR"

echo "Operaci√≥n completada. Directorio copiado de '$SRC_DIR' a '$DEST_DIR'."
