#!/bin/bash

# Verifica si se proporcionan los argumentos correctos
if [ "$#" -ne 2 ]; then
    echo "Uso: $0 <directorio_origen> <directorio_destino>"
    exit 1
fi

SRC_DIR=$1
DEST_DIR=$2

# Crear el directorio de destino si no existe
mkdir -p "$DEST_DIR"

# Función para procesar cada subdirectorio
process_directory() {
    local dir=$1
    echo "Procesando directorio: $dir"

    # Verificar si el directorio contiene un repositorio de Git
    if [ -d "$dir/.git" ]; then
        echo "Encontrado repositorio de Git en $dir, eliminando .git..."
        rm -rf "$dir/.git"  # Elimina la carpeta .git para desvincular el repositorio
    fi
}

# Exportar la función para que sea visible en subshells
export -f process_directory

# Buscar todos los directorios en el directorio de origen y procesarlos
find "$SRC_DIR" -type d -print0 | xargs -0 -I {} bash -c 'process_directory "$@"' _ {}

# Copiar todo desde el directorio origen al directorio destino
cp -a "$SRC_DIR/." "$DEST_DIR/"

echo "Todos los datos han sido copiados de '$SRC_DIR' a '$DEST_DIR'."
